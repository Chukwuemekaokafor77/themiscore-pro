{% extends 'base.html' %}
{% block title %}Calendar{% endblock %}
{% block page_title %}Calendar{% endblock %}
{% block content %}
<div class="card">
  <div class="card-header d-flex justify-content-between">
    <span>Upcoming Events</span>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('calendar_ics') }}">Export ICS</a>
  </div>
  <div class="card-body">
    <table class="table table-striped">
      <thead>
        <tr>
          <th>#</th>
          <th>Title</th>
          <th>Start</th>
          <th>End</th>
          <th>All-day</th>
          <th>Case</th>
          <th>Client</th>
          <th>Location</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for ev in events %}
        <tr>
          <td>{{ loop.index }}</td>
          <td>{{ ev.title }}</td>
          <td>{{ ev.start_at|format_date }}</td>
          <td>{{ ev.end_at|format_date if ev.end_at else '-' }}</td>
          <td>{{ 'Yes' if ev.all_day else 'No' }}</td>
          <td>{% if ev.case %}<a href="{{ url_for('view_case', case_id=ev.case.id) }}">{{ ev.case.title }}</a>{% else %}-{% endif %}</td>
          <td>{% if ev.client %}{{ ev.client.first_name }} {{ ev.client.last_name }}{% else %}-{% endif %}</td>
          <td>{{ ev.location or '-' }}</td>
          <td>{{ ev.status }}</td>
        </tr>
        {% else %}
        <tr><td colspan="9" class="text-center text-muted">No events.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
